# Install Docker menggunakan bash script

buat file bash script untuk installer docker
```
#!/bin/bash

read -p "ketik y untuk menginstall docker, ketik sembarang kata untuk membatalkan   " choice

if [ $choice = "y" ]
then
    echo "###########################"
    echo "update repository"
    echo "###########################"
    sudo apt-get update -y

    echo "menghapus semua versi lama docker bila ada"
    sudo apt-get remove docker docker-engine docker.io containerd runc -y
    
    echo "###########################"
    echo "install depedency yang diperlukan"
    echo "###########################"
    sudo apt-get install \
        ca-certificates \
        curl \
        gnupg \
        lsb-release -y
    
    echo "###########################"
    echo "install GPG key"
    echo "###########################"
    sudo mkdir -p /etc/apt/keyrings
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

    echo "###########################"
    echo "set up repository"
    echo "###########################"
    echo \
        "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
        $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

    echo "###########################"
    echo "update repository lagi"
    echo "###########################"
    sudo apt-get update -y
    
    echo "###########################"
    echo "install docker engine, containerd, dan docker compose"
    echo "###########################"
    sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin -y

    echo "###########################"
    echo "tambahkan user yang ada sekarang ke dalam grup docker"
    echo "###########################"
    sudo usermod -aG docker $(whoami)
    pwd
    
    echo "###########################"
    echo "docker berhasil di install"
    echo "###########################"
    exec bash
else
    echo "script berhenti"
fi
```
![image](https://user-images.githubusercontent.com/36489276/206748910-520c2572-9e45-4159-87ae-03390f4a5870.png)

setelah itu jalankan perintah chmod untuk memberi akses kepada user untuk melakukan read, write dan execute
```
chmod 700 docker_installer.sh
```
![image](https://user-images.githubusercontent.com/36489276/206748965-d78e282e-0e14-44aa-a83f-5645ded16d1f.png)

jalankan docker installer
```
./docker_installer.sh
```
![image](https://user-images.githubusercontent.com/36489276/206749063-b0c022cb-4bb8-4229-bf57-ba8710c0281a.png)

ketik y untuk melanjutkan

# daftarkan domain di cloudflare
buka ![dashboard cloudflare](https://dash.cloudflare.com/)
![image](https://user-images.githubusercontent.com/36489276/206749476-f264b01d-e928-4d45-a0ef-48ee17e98ad8.png)

pilih akun yang memiliki domain

pilih domain yang aktif
![image](https://user-images.githubusercontent.com/36489276/206749702-dc26e812-eb04-4bc3-8ca2-4e50b66f5aed.png)

di sebelah kiri, pilih dns
![image](https://user-images.githubusercontent.com/36489276/206749817-31cadb4c-a7ae-4ba6-b332-ed0add1e9ca2.png)

pilih add record, masukan domain yang ingin kita gunakan, masukan ip publik dari webserver, matikan proxy status, pilih save
![image](https://user-images.githubusercontent.com/36489276/206750917-d71e8f28-0d0d-4220-896a-07cca0125824.png)

lakukan langkah tadi untuk domain backend, namun jangan lupa tambahkan awalan api.
![image](https://user-images.githubusercontent.com/36489276/206751830-b06e1924-fddd-4dd2-a0a0-19361a5f2b54.png)


# Setup Housy-Frontend BARUBARUBAUKSLFJLKSJFKLASJFKLSAJF
Clone terlebih dahulu project housy-frontend
```
git clone https://github.com/dumbwaysdev/housy-frontend
```
![image](https://user-images.githubusercontent.com/36489276/206749978-ab1f0d92-fff9-4522-9d68-237a389e5dc0.png)

masuk ke direktori tersebut

![image](https://user-images.githubusercontent.com/36489276/206750052-a73caba6-de88-4e1e-a8d5-fb32d02b1f63.png)


kita perlu untuk mengkonfigurasi frontend agar dapat berkomunikasi dengan backend, edit file /src/config/api.js.
ubah alamat baseURL menjadi alamat domain backend kita
```
nano src/config/api.js
```
![image](https://user-images.githubusercontent.com/36489276/206768146-e62d7fb5-b993-4f6a-a88d-a60492cff43e.png)


buat sebuah dockerfile untuk kita build menjadi docker image
```
nano Dockerfile
```

setelah itu isikan sebagi berikut
```
FROM node:10.10.0-alpine
WORKDIR ./app
COPY . .
RUN npm install
EXPOSE 3000
CMD ["npm","start"]
```
![image](https://user-images.githubusercontent.com/36489276/206768506-3ac33ffd-d062-46c9-b89b-2e046173995e.png)

setelah itu, build docker image dengan menggunakan perintah
```
docker build -t reiya/housy-frontend .
```
![image](https://user-images.githubusercontent.com/36489276/206769146-5ec639a9-402e-4053-9fee-7ec7e2ea98a0.png)

jika sudah, lihat hasil image yang di build menggunakan perintah
```
docker image ls
```
![image](https://user-images.githubusercontent.com/36489276/206769196-7969d89e-5e4d-4027-a078-cd6480f9cd07.png)

lalu kita akan membuat sebuah file yang bernama docker-compose.yml, yang berisikan perintah untuk membuild sebuah container dari sebuah image yang sudah kita buat
```
nano docker-compose.yml
```
![image](https://user-images.githubusercontent.com/36489276/206769426-e0e26f4b-0766-44c9-aa3b-8430e62c029f.png)

```
version: '3.7'
services:
 frontend:
   container_name: frontend
   image: frontend/housy-frontend
   stdin_open: true
   restart: unless-stopped
   ports:
    - 3000:3000
```
![image](https://user-images.githubusercontent.com/36489276/206769498-942e8b24-6e00-4d04-a99a-d6b3ab4bcc84.png)

jalankan docker compose
```
docker compose up -d
```
![image](https://user-images.githubusercontent.com/36489276/206769762-d401aca7-97b9-4c22-8457-1474eafe2949.png)

cek apakah docker container sudah berjalan dengan menggunakan perintah
```
docker container ls
```
![image](https://user-images.githubusercontent.com/36489276/206769981-394cb163-601a-4ac7-97db-b6b5974db6fe.png)

akses menggunakan ip publik dari appserver dan gunakan port 3000 untuk mengecek apakah sudah berhasil
![image](https://user-images.githubusercontent.com/36489276/206770098-9322ecaf-b783-4f99-a126-e6381ba6e3ad.png)

# setup database mysql

buat sebuah file docker compose
```
nano nama_file
```
![image](https://user-images.githubusercontent.com/36489276/206771736-343b2603-0eca-42ec-b191-9f53963484e8.png)

isikan kurang lebih sebagai berikut
```
version: '3.7'

services:
  database:
    container_name: database
    image: mysql:latest
    environment:
      MYSQL_DATABASE: 'housy'
      MYSQL_USER: 'reiya'
      MYSQL_PASSWORD: 'reiya'
      MYSQL_ROOT_PASSWORD: 'reiya'
    ports:
      - '3306:3306'
    restart: unless-stopped
    volumes:
      - ~/konfigurasi_mysql:/var/lib/mysql
```
![image](https://user-images.githubusercontent.com/36489276/206771551-cd43513a-38ec-4593-8a04-c2f1c367c1c7.png)

jalankan docker compose
```
docker compose -f mysql_compose.yml up -d
```
![image](https://user-images.githubusercontent.com/36489276/206772008-3d919706-f7cf-45b1-9e11-c4b4355e0047.png)

cek apakah container sudah berjalan
```
docker container ls
```
![image](https://user-images.githubusercontent.com/36489276/206772259-c8a41e94-ca02-46c5-b61e-b7a84c87d74c.png)

# Setup housy backend
clone terlebih dahulu housy backend, setelah itu masuk ke dalam direktori tersebut

konfigurasi file database yang berada di config/config.json, ubah username dan password mysql yang sudah kita setup sebelumnya.
ubah host ke ip private kita
```
nano config/config.json
```
![image](https://user-images.githubusercontent.com/36489276/206773301-be74fd1e-b4fb-456f-8f84-6c9926035612.png)

setelah itu, kita akan membuat sebuah Dockerfile untuk membuat sebuah image yang ingin kita buat, masukan :
```
FROM node:10.10.0-alpine
WORKDIR ./app
COPY . .
RUN npm install
RUN npm install -g sequelize-cli
RUN npx sequelize db:migrate --env development
EXPOSE 5000
CMD ["npm","start"]
```
![image](https://user-images.githubusercontent.com/36489276/206774560-1048761c-3af2-4378-89ad-604cd471af2d.png)

setelah itu, build dockerfilenya dengan menggunakan perintah:
```
docker build -t reiya24/housy-backend .
```
![image](https://user-images.githubusercontent.com/36489276/206775267-47681512-199a-4978-983d-cb37ad6a9efd.png)

lalu buat file docker compose berisikan
```
version: '3.7'
services:
  backend:
    restart: unless-stopped
    container_name: backend
    image: reiya24/housy-backend
    stdin_open: true
    ports:
      - 5000:5000
```
![image](https://user-images.githubusercontent.com/36489276/206775954-9ed9d345-b5c7-4a29-80b2-a838bce66fb8.png)


lalu, setelah itu jalankan docker compose untuk membuat container housy backend
![image](https://user-images.githubusercontent.com/36489276/206776206-a55cab03-fd0b-4a64-9532-dd6fd9547f44.png)

# Push image ke docker hub
login terlebih dahulu menggunakan perintah
```
docker login
```
setelah itu masukan username dan password (saya sudah melakukan login jadi tidak ada input username dan password)
![image](https://user-images.githubusercontent.com/36489276/206777097-e0a7f1e7-e969-4f79-ad1f-22fff622fba7.png)

lalu push docker image dengan menggunakan perintah
```
docker push reiya24/housy-frontend:latest
```
![image](https://user-images.githubusercontent.com/36489276/206778713-6ce7ad36-cc14-4051-9e62-7b35f8a786b7.png)

lakukan hal yang sama untuk backend
```
docker push reiya24/housy-backend:latest
```
![image](https://user-images.githubusercontent.com/36489276/206778911-15be1758-2144-4fda-9349-0a5991d835e8.png)

berhasil melakukan push
![image](https://user-images.githubusercontent.com/36489276/206779107-56687764-a6c1-4b44-8853-0ad9a1c7acc0.png)

# instalasi nginx pada webserver
lakukan update package
```
sudo apt update -y
```
![image](https://user-images.githubusercontent.com/36489276/205620053-807b1fa2-2641-477b-86dc-e95cf770dab2.png)

install nginx
```
sudo apt install nginx -y
```
![image](https://user-images.githubusercontent.com/36489276/205620259-15f2e542-d922-49d7-a498-d06f9e33db6a.png)

setelah itu, buat folder baru untuk reverse proxy
```
sudo mkdir housy
```
![image](https://user-images.githubusercontent.com/36489276/205620473-0fed2506-bac8-4f9d-98dc-4742be141f38.png)

untuk membuat direktori housy terbaca oleh nginx, kita perlu mengaturnya di file nginx.conf
```
sudo nano nginx.conf
```

hapus tanda pagar yang pada baris yang ditandai agar kita dapat menggunakan domain yang panjang
![image](https://user-images.githubusercontent.com/36489276/205621089-66739d43-348b-4a85-8be1-b8cab96711a8.png)


setelah itu, pergi ke baris bawah sampai menemukan kata include.
tambahkan lokasi direktori housy agar nginx mau membacanya
```
include /etc/nginx/housy/*;
```
![image](https://user-images.githubusercontent.com/36489276/205621240-6e79c928-f056-468e-87de-6d6067fbfbb1.png)

cek syntaxnya dengan menggunakan perintah
```
sudo nginx -t
```
![image](https://user-images.githubusercontent.com/36489276/205621719-e108e1f1-9bde-4ffc-a750-c5fd5148ff32.png)

setelah itu, buat konfigurasi reverse proxy, untuk frontend dan untuk backend

![image](https://user-images.githubusercontent.com/36489276/205634868-e1d5970f-b9dd-499e-a1f1-2cc843ad668d.png)

![image](https://user-images.githubusercontent.com/36489276/205634954-74657371-8698-43f5-9928-7d1aa54479ad.png)


# Instalasi Certbot untuk Https

lakukan proses update pada snap agar mendapatkan versi terbaru dari snapd
```
sudo snap install core; sudo snap refresh core
```
![image](https://user-images.githubusercontent.com/36489276/205630257-c9ec91a4-91c1-444a-8ef2-841f7840b76a.png)


setelah itu install certbot menggunakan snap
```
sudo snap install --classic certbot
```
![image](https://user-images.githubusercontent.com/36489276/205629776-bbaad16b-657e-42d5-89d2-91128e8f0b3b.png)

tambahkan path certbot agar perintah certbot dapat dijalankan
```
sudo ln -s /snap/bin/certbot /usr/bin/certbot
```
![image](https://user-images.githubusercontent.com/36489276/205630486-2b999fa8-0deb-49da-bee2-23f350a3adab.png)

jalankan certbot
```
sudo certbot --nginx
```
![image](https://user-images.githubusercontent.com/36489276/205630913-1f830451-302f-4046-89c7-62fc9cf1b7ab.png)

masukan email untuk mendapatkan pemberitahuan dari certbot
![image](https://user-images.githubusercontent.com/36489276/205630985-46d153cb-ac68-43d5-8c2f-17bc5186f3ad.png)

alu kita harus setuju dengan syarat dan ketentuan, pilih y 
![image](https://user-images.githubusercontent.com/36489276/205631060-96606a48-3684-4113-bd7d-1d55020a698f.png)

pilih n agar tidak langganan email ke Electronic frontier foundation 
![image](https://user-images.githubusercontent.com/36489276/205631180-666bbf96-97c4-4e02-b12c-42c94e359f67.png)

pilih enter untuk pilih semua domain
![image](https://user-images.githubusercontent.com/36489276/205631465-17f33ce6-6298-4c65-838f-bc4b8453835e.png)

pemasangan berhasil
![image](https://user-images.githubusercontent.com/36489276/205631583-4ac30909-c0d5-4b45-954a-3aaa47f94b86.png)

# mencoba website housy
masuk ke alamat https://kelompok1.studentdumbways.my.id/

![image](https://user-images.githubusercontent.com/36489276/205686625-b58e471d-13d0-49c5-860f-85703b8d092e.png)

coba untuk mendaftar
![image](https://user-images.githubusercontent.com/36489276/205686770-dee2d0f7-6464-4bbe-b2e1-8c52a278ad32.png)

akses mendaftar berhasil
![image](https://user-images.githubusercontent.com/36489276/205686866-aab74e97-111e-419a-a119-edd7ff4b4a89.png)

# setup nginx on top docker GAGAL 
buat virtual machine webserver

install docker menggunakan script diatas, ubah perizinannya, dan eksekusi filenya
![image](https://user-images.githubusercontent.com/36489276/206752523-4c072ecf-e292-417d-b4a8-4282573bc31a.png)

buat sebuah docker compose untuk nginx
![image](https://user-images.githubusercontent.com/36489276/206753069-726f7779-84dc-43dd-a521-8a6179a3613e.png)

isikan kurang lebih seperti berikut
```
version: '3.7'

services:
  nginx:
    container_name: nginx
    image: nginx:latest
    restart: unless-stopped
    stdin_open: true
    ports:
      - 80:80
      - 443:443
```
![image](https://user-images.githubusercontent.com/36489276/206763960-27b1efc2-5fae-46dc-aed9-412203ee8b11.png)

setelah itu build docker compose
```
docker compose -f nama_file up -d
```
![image](https://user-images.githubusercontent.com/36489276/206754772-d04213f7-f2f7-4f7b-872e-c14937c728df.png)

setelah itu, untuk melakukan konfigurasi masuk ke dalam contianer dengan mengakses bash di container nginx menggunakan perintah
```
docker container exec -i -t nama_container /bin/bash
```
![image](https://user-images.githubusercontent.com/36489276/206764643-dc179530-0bb5-4407-9f16-5712ffa35ede.png)

untuk menyetel konfigurasi nginx, pergi ke direktori /etc/nginx
```
cd /etc/nginx
```
![image](https://user-images.githubusercontent.com/36489276/206765069-69b56cb0-5601-4837-9b17-f1206813c2c9.png)

buat direktori baru dimana kita akan menyimpan file konfigurasi kita
```
mkdir nama_folder
```
![image](https://user-images.githubusercontent.com/36489276/206765198-ffa8c2d4-36bd-4f41-914c-c69aee896b07.png)

setelah itu, kita buka file nginx.conf untuk menambahakn direkotri kita agar dapat terbaca di nginx
```
nano nginx.conf
```
![image](https://user-images.githubusercontent.com/36489276/206766414-d90dbfc3-0c4a-47f4-a8e7-ee5db588d346.png)

# CATATAN GAGAL

## nginx on top docker
jika kita melakukan mounting volume /etc/nginx container akan terus restart. logs:

![image](https://user-images.githubusercontent.com/36489276/206759993-195e7efb-92a4-4a60-a859-f881d06b2724.png)

jika kita melakukan mounting volume /etc/nginx/conf.d dan /etc/nginx/sites enabled, container jalan  namun tidak bisa diakses web browser


